#include "contiki.h"
#include "lib/memb.h" //for memory block allocation
#include <stdio.h>
#include "dev/light-sensor.h" //for light sensor
#include <math.h>
#include "sys/rtimer.h"
#include "inttypes.h"

// parameters
#define _N 512                      // number of temperature readings
#define L 64                        // size of the temperature block
#define M 40                         // size of the compressed block
#define FIXED_POINT_SCALE pow(2, 5) // scale factor for fixed-point arithmetic

// Memory block declarations
MEMB(compressed_block_memb, int32_t, M); // Memory block for storing M-size compressed DCT block
MEMB(temp_block_memb, int32_t, L);       // Memory block for storing L-size temperature block

// // manually inputted H matrix
// static int32_t H[L][L] = {
//     {8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
//     {11, 10, 9, 8, 7, 5, 3, 1, -1, -3, -5, -7, -8, -9, -10, -11},
//     {11, 9, 6, 2, -2, -6, -9, -11, -11, -9, -6, -2, 2, 6, 9, 11},
//     {10, 7, 1, -5, -9, -11, -8, -3, 3, 8, 11, 9, 5, -1, -7, -10},
//     {10, 4, -4, -10, -10, -4, 4, 10, 10, 4, -4, -10, -10, -4, 4, 10},
//     {9, 1, -8, -10, -3, 7, 11, 5, -5, -11, -7, 3, 10, 8, -1, -9},
//     {9, -2, -11, -6, 6, 11, 2, -9, -9, 2, 11, 6, -6, -11, -2, 9},
//     {8, -5, -10, 1, 11, 3, -9, -7, 7, 9, -3, -11, -1, 10, 5, -8},
//     {8, -8, -8, 7, 8, -7, -7, 7, 7, -7, -7, 7, 8, -7, -8, 7},
//     {7, -9, -3, 11, -1, -10, 5, 8, -8, -5, 10, 1, -11, 3, 9, -7},
//     {6, -11, 2, 9, -9, -2, 11, -6, -6, 11, -2, -9, 9, 2, -11, 6},
//     {5, -11, 7, 3, -10, 8, 1, -9, 9, -1, -8, 10, -3, -7, 11, -5},
//     {4, -10, 10, -4, -4, 10, -10, 4, 4, -10, 10, -4, -4, 10, -10, 4},
//     {3, -8, 11, -9, 5, 1, -7, 10, -10, 7, -1, -5, 9, -11, 8, -3},
//     {2, -6, 9, -11, 11, -9, 6, -2, -2, 6, -9, 11, -11, 9, -6, 2},
//     {1, -3, 5, -7, 8, -9, 10, -11, 11, -10, 9, -8, 7, -5, 3, -1}};

static int32_t H[L][L] = {
    {4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4},
    {5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -2, -2, -2, -2, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5},
    {5, 5, 5, 5, 5, 4, 4, 4, 3, 3, 2, 2, 1, 1, 0, 0, 0, 0, -1, -1, -2, -2, -3, -3, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -4, -4, -4, -3, -3, -2, -2, -1, -1, 0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 4, 5, 5, 5, 5, 5},
    {5, 5, 5, 4, 4, 3, 3, 2, 1, 0, 0, 0, -1, -2, -3, -3, -4, -4, -5, -5, -5, -5, -5, -5, -5, -4, -4, -3, -2, -2, -1, 0, 0, 1, 2, 2, 3, 4, 4, 5, 5, 5, 5, 5, 5, 5, 4, 4, 3, 3, 2, 1, 0, 0, 0, -1, -2, -3, -3, -4, -4, -5, -5, -5},
    {5, 5, 4, 4, 3, 2, 1, 0, 0, -1, -2, -3, -4, -4, -5, -5, -5, -5, -4, -4, -3, -2, -1, 0, 0, 1, 2, 3, 4, 4, 5, 5, 5, 5, 4, 4, 3, 2, 1, 0, 0, -1, -2, -3, -4, -4, -5, -5, -5, -5, -4, -4, -3, -2, -1, 0, 0, 1, 2, 3, 4, 4, 5, 5},
    {5, 5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5, -5, -5, -5, -4, -3, -2, 0, 0, 1, 3, 4, 4, 5, 5, 5, 5, 4, 3, 2, 0, 0, -2, -3, -4, -5, -5, -5, -5, -4, -4, -3, -1, 0, 0, 2, 3, 4, 5, 5, 5, 5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5, -5},
    {5, 5, 4, 2, 1, 0, -1, -3, -4, -5, -5, -5, -4, -3, -2, 0, 0, 2, 3, 4, 5, 5, 5, 4, 3, 1, 0, -1, -2, -4, -5, -5, -5, -5, -4, -2, -1, 0, 1, 3, 4, 5, 5, 5, 4, 3, 2, 0, 0, -2, -3, -4, -5, -5, -5, -4, -3, -1, 0, 1, 2, 4, 5, 5},
    {5, 4, 3, 2, 0, -1, -3, -4, -5, -5, -5, -3, -2, 0, 1, 3, 4, 5, 5, 5, 4, 2, 0, -1, -3, -4, -5, -5, -5, -4, -2, 0, 0, 2, 4, 5, 5, 5, 4, 3, 1, 0, -2, -4, -5, -5, -5, -4, -3, -1, 0, 2, 3, 5, 5, 5, 4, 3, 1, 0, -2, -3, -4, -5},
    {5, 4, 3, 1, -1, -3, -4, -5, -5, -4, -3, -1, 1, 3, 4, 5, 5, 4, 3, 1, -1, -3, -4, -5, -5, -4, -3, -1, 1, 3, 4, 5, 5, 4, 3, 1, -1, -3, -4, -5, -5, -4, -3, -1, 1, 3, 4, 5, 5, 4, 3, 1, -1, -3, -4, -5, -5, -4, -3, -1, 1, 3, 4, 5},
    {5, 4, 2, 0, -2, -4, -5, -5, -4, -2, 0, 2, 4, 5, 5, 4, 3, 0, -1, -3, -5, -5, -4, -3, 0, 1, 3, 5, 5, 5, 3, 1, -1, -3, -5, -5, -5, -3, -1, 0, 3, 4, 5, 5, 3, 1, 0, -3, -4, -5, -5, -4, -2, 0, 2, 4, 5, 5, 4, 2, 0, -2, -4, -5},
    {5, 4, 1, 0, -3, -5, -5, -4, -2, 0, 2, 4, 5, 5, 3, 1, -1, -3, -5, -5, -4, -2, 0, 2, 4, 5, 5, 3, 0, -1, -4, -5, -5, -4, -1, 0, 3, 5, 5, 4, 2, 0, -2, -4, -5, -5, -3, -1, 1, 3, 5, 5, 4, 2, 0, -2, -4, -5, -5, -3, 0, 1, 4, 5},
    {5, 3, 1, -1, -4, -5, -5, -3, 0, 2, 4, 5, 5, 3, 0, -2, -4, -5, -4, -2, 0, 3, 5, 5, 4, 2, 0, -3, -5, -5, -4, -1, 1, 4, 5, 5, 3, 0, -2, -4, -5, -5, -3, 0, 2, 4, 5, 4, 2, 0, -3, -5, -5, -4, -2, 0, 3, 5, 5, 4, 1, -1, -3, -5},
    {5, 3, 0, -2, -4, -5, -4, -1, 1, 4, 5, 4, 2, 0, -3, -5, -5, -3, 0, 2, 4, 5, 4, 1, -1, -4, -5, -4, -2, 0, 3, 5, 5, 3, 0, -2, -4, -5, -4, -1, 1, 4, 5, 4, 2, 0, -3, -5, -5, -3, 0, 2, 4, 5, 4, 1, -1, -4, -5, -4, -2, 0, 3, 5},
    {5, 3, 0, -3, -5, -5, -3, 0, 3, 5, 5, 2, 0, -3, -5, -5, -2, 0, 4, 5, 4, 2, -1, -4, -5, -4, -2, 1, 4, 5, 4, 1, -1, -4, -5, -4, -1, 2, 4, 5, 4, 1, -2, -4, -5, -4, 0, 2, 5, 5, 3, 0, -2, -5, -5, -3, 0, 3, 5, 5, 3, 0, -3, -5},
    {5, 2, 0, -4, -5, -4, -1, 2, 5, 5, 3, 0, -3, -5, -4, -1, 1, 4, 5, 3, 0, -3, -5, -5, -2, 1, 4, 5, 4, 0, -2, -5, -5, -2, 0, 4, 5, 4, 1, -2, -5, -5, -3, 0, 3, 5, 4, 1, -1, -4, -5, -3, 0, 3, 5, 5, 2, -1, -4, -5, -4, 0, 2, 5},
    {5, 2, -1, -4, -5, -3, 0, 4, 5, 4, 0, -3, -5, -4, -1, 2, 5, 5, 2, -1, -4, -5, -3, 0, 3, 5, 4, 0, -3, -5, -5, -2, 2, 5, 5, 3, 0, -4, -5, -3, 0, 3, 5, 4, 1, -2, -5, -5, -2, 1, 4, 5, 3, 0, -4, -5, -4, 0, 3, 5, 4, 1, -2, -5},
    {5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5, 5, 2, -2, -5, -5, -2, 2, 5},
    {5, 1, -2, -5, -4, 0, 3, 5, 3, 0, -4, -5, -3, 1, 5, 5, 2, -2, -5, -4, 0, 3, 5, 4, 0, -4, -5, -3, 1, 4, 5, 2, -2, -5, -4, -1, 3, 5, 4, 0, -4, -5, -3, 0, 4, 5, 2, -2, -5, -5, -1, 3, 5, 4, 0, -3, -5, -3, 0, 4, 5, 2, -1, -5},
    {5, 1, -3, -5, -3, 0, 4, 5, 1, -2, -5, -4, 0, 4, 5, 2, -2, -5, -4, 0, 4, 5, 2, -1, -5, -4, 0, 3, 5, 3, -1, -5, -5, -1, 3, 5, 3, 0, -4, -5, -1, 2, 5, 4, 0, -4, -5, -2, 2, 5, 4, 0, -4, -5, -2, 1, 5, 4, 0, -3, -5, -3, 1, 5},
    {5, 0, -3, -5, -2, 2, 5, 4, 0, -4, -5, -1, 3, 5, 3, -1, -5, -4, 0, 4, 5, 2, -3, -5, -3, 1, 5, 4, 0, -4, -5, -2, 2, 5, 4, 0, -4, -5, -1, 3, 5, 3, -2, -5, -4, 0, 4, 5, 1, -3, -5, -3, 1, 5, 4, 0, -4, -5, -2, 2, 5, 3, 0, -5},
    {4, 0, -4, -5, -1, 3, 5, 2, -2, -5, -3, 1, 5, 4, 0, -4, -4, 0, 4, 5, 1, -3, -5, -2, 2, 5, 3, -1, -5, -4, 0, 4, 4, 0, -4, -5, -1, 3, 5, 2, -2, -5, -3, 1, 5, 4, 0, -4, -4, 0, 4, 5, 1, -3, -5, -2, 2, 5, 3, -1, -5, -4, 0, 4},
    {4, 0, -4, -5, 0, 4, 5, 0, -4, -5, 0, 4, 5, 1, -4, -5, -1, 3, 5, 1, -3, -5, -2, 3, 5, 2, -3, -5, -2, 3, 5, 2, -2, -5, -3, 2, 5, 3, -2, -5, -3, 2, 5, 3, -1, -5, -3, 1, 5, 4, -1, -5, -4, 0, 5, 4, 0, -5, -4, 0, 5, 4, 0, -4},
    {4, 0, -5, -4, 0, 5, 4, -1, -5, -3, 1, 5, 3, -2, -5, -2, 2, 5, 2, -3, -5, -1, 3, 5, 1, -4, -5, 0, 4, 5, 0, -4, -4, 0, 5, 4, 0, -5, -4, 1, 5, 3, -1, -5, -3, 2, 5, 2, -2, -5, -2, 3, 5, 1, -3, -5, -1, 4, 5, 0, -4, -5, 0, 4},
    {4, 0, -5, -3, 2, 5, 2, -3, -5, -1, 4, 5, 0, -5, -4, 1, 5, 3, -2, -5, -2, 3, 5, 0, -4, -4, 0, 5, 4, -1, -5, -3, 3, 5, 1, -4, -5, 0, 4, 4, 0, -5, -3, 2, 5, 2, -3, -5, -1, 4, 5, 0, -5, -4, 1, 5, 3, -2, -5, -2, 3, 5, 0, -4},
    {4, -1, -5, -3, 3, 5, 1, -4, -4, 1, 5, 3, -3, -5, -1, 4, 4, -1, -5, -3, 3, 5, 1, -4, -4, 1, 5, 3, -3, -5, -1, 4, 4, -1, -5, -3, 3, 5, 1, -4, -4, 1, 5, 3, -3, -5, -1, 4, 4, -1, -5, -3, 3, 5, 1, -4, -4, 1, 5, 3, -3, -5, -1, 4},
    {4, -1, -5, -2, 4, 5, 0, -5, -3, 3, 5, 0, -5, -3, 2, 5, 0, -4, -4, 2, 5, 1, -4, -4, 1, 5, 2, -3, -5, 0, 5, 3, -3, -5, 0, 5, 3, -2, -5, -1, 4, 4, -1, -5, -2, 4, 4, 0, -5, -2, 3, 5, 0, -5, -3, 3, 5, 0, -5, -4, 2, 5, 1, -4},
    {4, -1, -5, -1, 4, 4, -2, -5, 0, 5, 3, -2, -5, 0, 5, 3, -3, -5, 0, 5, 2, -3, -5, 0, 5, 2, -4, -4, 1, 5, 1, -4, -4, 1, 5, 1, -4, -4, 2, 5, 0, -5, -3, 2, 5, 0, -5, -3, 3, 5, 0, -5, -2, 3, 5, 0, -5, -2, 4, 4, -1, -5, -1, 4},
    {4, -2, -5, 0, 5, 3, -3, -4, 1, 5, 1, -5, -3, 3, 5, 0, -5, -2, 4, 4, -2, -5, 0, 5, 2, -4, -4, 1, 5, 0, -5, -3, 3, 5, 0, -5, -1, 4, 4, -2, -5, 0, 5, 2, -4, -4, 2, 5, 0, -5, -3, 3, 5, -1, -5, -1, 4, 3, -3, -5, 0, 5, 2, -4},
    {4, -2, -5, 0, 5, 1, -4, -3, 3, 4, -1, -5, 0, 5, 2, -4, -4, 2, 5, 0, -5, -1, 4, 3, -3, -4, 1, 5, 0, -5, -2, 4, 4, -2, -5, 0, 5, 1, -4, -3, 3, 4, -1, -5, 0, 5, 2, -4, -4, 2, 5, 0, -5, -1, 4, 3, -3, -4, 1, 5, 0, -5, -2, 4},
    {4, -3, -5, 1, 5, 0, -5, -1, 5, 3, -4, -4, 2, 5, -1, -5, 0, 5, 2, -4, -3, 3, 4, -2, -5, 0, 5, 0, -5, -2, 4, 3, -3, -4, 2, 5, 0, -5, 0, 5, 2, -4, -3, 3, 4, -2, -5, 0, 5, 1, -5, -2, 4, 4, -3, -5, 1, 5, 0, -5, -1, 5, 3, -4},
    {4, -3, -4, 2, 5, -1, -5, 0, 5, 0, -5, -1, 5, 2, -4, -3, 3, 4, -2, -5, 1, 5, 0, -5, 0, 5, 1, -5, -2, 4, 3, -4, -4, 3, 4, -2, -5, 1, 5, 0, -5, 0, 5, 1, -5, -2, 4, 3, -3, -4, 2, 5, -1, -5, 0, 5, 0, -5, -1, 5, 2, -4, -3, 4},
    {4, -3, -4, 3, 4, -2, -5, 2, 5, -1, -5, 1, 5, 0, -5, 0, 5, 0, -5, 0, 5, 1, -5, -2, 5, 2, -4, -3, 4, 3, -4, -3, 3, 4, -3, -4, 3, 4, -2, -5, 2, 5, -1, -5, 0, 5, 0, -5, 0, 5, 0, -5, -1, 5, 1, -5, -2, 5, 2, -4, -3, 4, 3, -4},
    {4, -4, -4, 3, 4, -3, -3, 3, 3, -3, -3, 3, 4, -3, -4, 3, 4, -3, -4, 3, 4, -3, -4, 4, 4, -3, -4, 4, 4, -3, -4, 4, 4, -3, -4, 4, 4, -3, -4, 4, 4, -4, -4, 3, 3, -3, -4, 3, 4, -4, -4, 3, 3, -3, -4, 3, 4, -4, -4, 3, 3, -3, -4, 3},
    {3, -4, -3, 4, 3, -4, -2, 5, 2, -5, -1, 5, 0, -5, 0, 5, 0, -5, 0, 5, -1, -5, 1, 5, -2, -5, 2, 4, -3, -4, 3, 4, -4, -3, 4, 3, -4, -2, 5, 2, -5, -1, 5, 1, -5, 0, 5, 0, -5, 0, 5, 0, -5, 1, 5, -2, -5, 2, 4, -3, -4, 3, 4, -3},
    {3, -4, -2, 5, 1, -5, 0, 5, 0, -5, 1, 5, -2, -4, 3, 4, -4, -3, 4, 2, -5, -1, 5, 0, -5, 0, 5, -1, -5, 2, 4, -3, -3, 4, 2, -5, -1, 5, 0, -5, 0, 5, -1, -5, 2, 4, -3, -4, 4, 3, -4, -2, 5, 1, -5, 0, 5, 0, -5, 1, 5, -2, -4, 3},
    {3, -4, -2, 5, 0, -5, 0, 5, -2, -4, 3, 3, -4, -2, 5, 0, -5, 1, 5, -2, -4, 4, 3, -5, -1, 5, 0, -5, 1, 5, -3, -4, 4, 3, -5, -1, 5, 0, -5, 1, 5, -3, -4, 4, 2, -5, -1, 5, 0, -5, 2, 4, -3, -3, 4, 2, -5, 0, 5, 0, -5, 2, 4, -3},
    {3, -4, -1, 5, 0, -5, 2, 4, -4, -2, 5, 0, -5, 1, 4, -3, -3, 4, 1, -5, 0, 5, -2, -4, 4, 2, -5, 0, 5, -1, -4, 3, 3, -4, -1, 5, 0, -5, 2, 4, -4, -2, 5, 0, -5, 1, 4, -3, -3, 4, 1, -5, 0, 5, -2, -4, 4, 2, -5, 0, 5, -1, -4, 3},
    {3, -5, 0, 5, -1, -4, 4, 2, -5, 0, 5, -2, -4, 4, 2, -5, 0, 5, -3, -3, 5, 1, -5, 1, 4, -3, -3, 5, 0, -5, 2, 4, -4, -2, 5, 0, -5, 3, 3, -4, -1, 5, -1, -5, 3, 3, -5, 0, 5, -2, -4, 4, 2, -5, 0, 5, -2, -4, 4, 1, -5, 0, 5, -3},
    {3, -5, 0, 5, -2, -3, 5, 0, -5, 2, 4, -4, -1, 5, -1, -4, 4, 1, -5, 1, 4, -4, -2, 5, 0, -5, 3, 2, -5, 0, 5, -3, -3, 5, 0, -5, 2, 3, -5, 0, 5, -2, -4, 4, 1, -5, 1, 4, -4, -1, 5, -1, -4, 4, 2, -5, 0, 5, -3, -2, 5, 0, -5, 3},
    {3, -5, 0, 5, -3, -2, 5, -1, -4, 4, 1, -5, 2, 4, -4, 0, 5, -2, -3, 5, 0, -5, 3, 3, -5, 0, 5, -4, -2, 5, -1, -4, 4, 1, -5, 2, 4, -5, 0, 5, -3, -3, 5, 0, -5, 3, 2, -5, 0, 4, -4, -2, 5, -1, -4, 4, 1, -5, 2, 3, -5, 0, 5, -3},
    {3, -5, 1, 4, -4, -1, 5, -3, -3, 5, -1, -4, 4, 1, -5, 3, 3, -5, 1, 4, -4, -1, 5, -3, -3, 5, -1, -4, 4, 1, -5, 3, 3, -5, 1, 4, -4, -1, 5, -3, -3, 5, -1, -4, 4, 1, -5, 3, 3, -5, 1, 4, -4, -1, 5, -3, -3, 5, -1, -4, 4, 1, -5, 3},
    {3, -5, 1, 4, -5, 0, 4, -4, 0, 5, -3, -2, 5, -2, -3, 5, -1, -4, 5, 0, -5, 4, 1, -5, 3, 2, -5, 2, 3, -5, 0, 4, -4, 0, 5, -3, -2, 5, -2, -3, 5, -1, -4, 5, 0, -5, 4, 1, -5, 3, 2, -5, 2, 3, -5, 0, 4, -4, 0, 5, -4, -1, 5, -3},
    {2, -5, 2, 3, -5, 1, 3, -5, 1, 4, -5, 0, 4, -5, 0, 4, -4, 0, 5, -4, 0, 5, -4, -1, 5, -3, -1, 5, -3, -2, 5, -2, -2, 5, -2, -3, 5, -1, -3, 5, -1, -4, 5, 0, -4, 5, 0, -4, 4, 0, -5, 4, 0, -5, 4, 1, -5, 3, 1, -5, 3, 2, -5, 2},
    {2, -5, 3, 2, -5, 3, 2, -5, 3, 2, -5, 3, 1, -5, 3, 1, -5, 4, 1, -5, 4, 0, -5, 4, 0, -5, 4, 0, -5, 4, 0, -4, 4, 0, -4, 5, 0, -4, 5, 0, -4, 5, 0, -4, 5, -1, -4, 5, -1, -3, 5, -1, -3, 5, -2, -3, 5, -2, -3, 5, -2, -3, 5, -2},
    {2, -5, 3, 1, -5, 4, 0, -4, 4, 0, -4, 5, -1, -3, 5, -2, -2, 5, -3, -1, 5, -4, 0, 4, -4, 0, 4, -5, 1, 3, -5, 2, 2, -5, 3, 1, -5, 4, 0, -4, 4, 0, -4, 5, -1, -3, 5, -2, -2, 5, -3, -1, 5, -4, 0, 4, -4, 0, 4, -5, 1, 3, -5, 2},
    {2, -5, 4, 0, -4, 5, -1, -3, 5, -3, -2, 5, -4, 0, 4, -5, 1, 3, -5, 3, 1, -5, 4, 0, -4, 5, -2, -2, 5, -3, 0, 5, -5, 0, 3, -5, 2, 2, -5, 4, 0, -4, 5, -1, -3, 5, -3, -1, 5, -4, 0, 4, -5, 2, 3, -5, 3, 1, -5, 4, 0, -4, 5, -2},
    {2, -5, 4, 0, -4, 5, -2, -1, 5, -4, 0, 3, -5, 3, 1, -5, 5, -1, -3, 5, -3, 0, 4, -5, 1, 2, -5, 4, 0, -4, 5, -2, -2, 5, -4, 0, 4, -5, 2, 1, -5, 4, 0, -3, 5, -3, -1, 5, -5, 1, 3, -5, 3, 0, -4, 5, -1, -2, 5, -4, 0, 4, -5, 2},
    {2, -5, 4, -1, -3, 5, -4, 0, 4, -5, 3, 0, -4, 5, -2, -2, 5, -5, 1, 3, -5, 4, 0, -3, 5, -3, 0, 4, -5, 2, 1, -5, 5, -1, -2, 5, -4, 0, 3, -5, 3, 0, -4, 5, -3, -1, 5, -5, 2, 2, -5, 4, 0, -3, 5, -4, 0, 4, -5, 3, 1, -4, 5, -2},
    {2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2, 2, -5, 5, -2, -2, 5, -5, 2},
    {2, -5, 5, -3, 0, 4, -5, 3, 0, -3, 5, -4, 1, 2, -5, 5, -2, -1, 4, -5, 3, 0, -4, 5, -4, 0, 3, -5, 4, -1, -2, 5, -5, 2, 1, -4, 5, -3, 0, 4, -5, 4, 0, -3, 5, -4, 1, 2, -5, 5, -2, -1, 4, -5, 3, 0, -3, 5, -4, 0, 3, -5, 5, -2},
    {1, -4, 5, -3, 0, 3, -5, 5, -2, -1, 4, -5, 4, 0, -2, 5, -5, 2, 0, -4, 5, -4, 1, 2, -5, 5, -3, 0, 3, -5, 4, -1, -1, 4, -5, 3, 0, -3, 5, -5, 2, 1, -4, 5, -4, 0, 2, -5, 5, -2, 0, 4, -5, 4, -1, -2, 5, -5, 3, 0, -3, 5, -4, 1},
    {1, -4, 5, -4, 1, 2, -4, 5, -4, 1, 2, -4, 5, -4, 0, 2, -5, 5, -3, 0, 2, -5, 5, -3, 0, 3, -5, 5, -3, 0, 3, -5, 5, -3, 0, 3, -5, 5, -3, 0, 3, -5, 5, -2, 0, 3, -5, 5, -2, 0, 4, -5, 4, -2, -1, 4, -5, 4, -2, -1, 4, -5, 4, -1},
    {1, -4, 5, -4, 2, 0, -3, 5, -5, 3, 0, -2, 4, -5, 4, -1, -1, 4, -5, 4, -2, 0, 3, -5, 5, -3, 0, 2, -4, 5, -4, 1, 1, -4, 5, -4, 2, 0, -3, 5, -5, 3, 0, -2, 4, -5, 4, -1, -1, 4, -5, 4, -2, 0, 3, -5, 5, -3, 0, 2, -4, 5, -4, 1},
    {1, -4, 5, -5, 3, 0, -2, 4, -5, 5, -3, 0, 2, -4, 5, -4, 2, 0, -3, 5, -5, 4, -2, 0, 3, -5, 5, -4, 1, 1, -3, 5, -5, 3, -1, -1, 4, -5, 5, -3, 0, 2, -4, 5, -5, 3, 0, -2, 4, -5, 4, -2, 0, 3, -5, 5, -4, 2, 0, -3, 5, -5, 4, -1},
    {1, -3, 5, -5, 4, -2, 0, 2, -4, 5, -5, 3, 0, -1, 4, -5, 5, -4, 1, 0, -3, 5, -5, 4, -2, 0, 2, -4, 5, -5, 3, -1, -1, 3, -5, 5, -4, 2, 0, -2, 4, -5, 5, -3, 0, 1, -4, 5, -5, 4, -1, 0, 3, -5, 5, -4, 2, 0, -2, 4, -5, 5, -3, 1},
    {1, -3, 5, -5, 5, -3, 1, 0, -3, 4, -5, 5, -3, 1, 0, -3, 4, -5, 5, -4, 2, 0, -2, 4, -5, 5, -4, 2, 0, -2, 4, -5, 5, -4, 2, 0, -2, 4, -5, 5, -4, 2, 0, -2, 4, -5, 5, -4, 3, 0, -1, 3, -5, 5, -4, 3, 0, -1, 3, -5, 5, -5, 3, -1},
    {1, -3, 4, -5, 5, -4, 3, -1, -1, 3, -4, 5, -5, 4, -3, 1, 1, -3, 4, -5, 5, -4, 3, -1, -1, 3, -4, 5, -5, 4, -3, 1, 1, -3, 4, -5, 5, -4, 3, -1, -1, 3, -4, 5, -5, 4, -3, 1, 1, -3, 4, -5, 5, -4, 3, -1, -1, 3, -4, 5, -5, 4, -3, 1},
    {0, -2, 4, -5, 5, -5, 4, -3, 1, 0, -2, 4, -5, 5, -5, 4, -3, 1, 0, -2, 3, -5, 5, -5, 4, -3, 1, 0, -2, 3, -4, 5, -5, 4, -3, 2, 0, -1, 3, -4, 5, -5, 5, -3, 2, 0, -1, 3, -4, 5, -5, 5, -4, 2, 0, -1, 3, -4, 5, -5, 5, -4, 2, 0},
    {0, -2, 3, -4, 5, -5, 5, -4, 3, -1, 0, 1, -2, 4, -5, 5, -5, 5, -4, 2, -1, 0, 1, -3, 4, -5, 5, -5, 4, -3, 2, 0, 0, 2, -3, 4, -5, 5, -5, 4, -3, 1, 0, -1, 2, -4, 5, -5, 5, -5, 4, -2, 1, 0, -1, 3, -4, 5, -5, 5, -4, 3, -2, 0},
    {0, -2, 3, -4, 5, -5, 5, -5, 4, -4, 3, -1, 0, 0, -2, 3, -4, 5, -5, 5, -5, 4, -3, 2, -1, 0, 1, -2, 3, -4, 5, -5, 5, -5, 4, -3, 2, -1, 0, 1, -2, 3, -4, 5, -5, 5, -5, 4, -3, 2, 0, 0, 1, -3, 4, -4, 5, -5, 5, -5, 4, -3, 2, 0},
    {0, -1, 2, -3, 4, -4, 5, -5, 5, -5, 4, -4, 3, -2, 1, 0, 0, 1, -2, 3, -4, 4, -5, 5, -5, 5, -4, 4, -3, 2, -1, 0, 0, -1, 2, -3, 4, -4, 5, -5, 5, -5, 4, -4, 3, -2, 1, 0, 0, 1, -2, 3, -4, 4, -5, 5, -5, 5, -4, 4, -3, 2, -1, 0},
    {0, -1, 2, -2, 3, -4, 4, -5, 5, -5, 5, -5, 5, -5, 4, -4, 3, -3, 2, -1, 0, 0, 0, 1, -2, 3, -3, 4, -4, 5, -5, 5, -5, 5, -5, 4, -4, 3, -3, 2, -1, 0, 0, 0, 1, -2, 3, -3, 4, -4, 5, -5, 5, -5, 5, -5, 5, -4, 4, -3, 2, -2, 1, 0},
    {0, 0, 1, -1, 2, -2, 3, -3, 4, -4, 4, -5, 5, -5, 5, -5, 5, -5, 5, -5, 5, -4, 4, -4, 3, -3, 2, -2, 1, -1, 0, 0, 0, 0, -1, 1, -2, 2, -3, 3, -4, 4, -4, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 4, -4, 4, -3, 3, -2, 2, -1, 1, 0, 0},
    {0, 0, 0, 0, 1, -1, 1, -2, 2, -2, 2, -3, 3, -3, 3, -3, 4, -4, 4, -4, 4, -4, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 5, -5, 4, -4, 4, -4, 4, -4, 3, -3, 3, -3, 3, -2, 2, -2, 2, -1, 1, -1, 0, 0, 0, 0}};

// // DCT matrix
// static int32_t H[L][L];

// // Function to create the DCT matrix
// void create_dct_matrix()
// {
//     for (int k = 0; k < L; ++k)
//     {
//         for (int n = 0; n < L; ++n)
//         {
//             // normalization factor
//             double alpha_k = (k == 0) ? sqrt(1.0 / L) : sqrt(2.0 / L);
//             // Populate H[k][n]
//             int32_t val = (int32_t)(alpha_k * cos(M_PI / L * (n + 0.5) * k) * FIXED_POINT_SCALE);
//             H[k][n] = val;
//         }
//     }
// }

// Function to perform the DCT transform on a block of data
void dct_transform(int32_t *x, int32_t *y)
{
    // Special handling for DC coefficient (y[0])
    int32_t dc_sum = 0;
    for (int n = 0; n < L; ++n)
    {
        dc_sum += (int32_t)x[n];
    }
    y[0] = (int)(dc_sum * H[0][0] / FIXED_POINT_SCALE);

    // Loop through the rows of the DCT matrix
    for (int k = 1; k < L; ++k)
    {
        // Initialize the sum for the k-th component
        int32_t sum = 0;

        // Loop through the input data
        for (int n = 0; n < L; ++n)
        {
            // Calculate the sum
            sum += (x[n] * H[k][n]);
        }

        y[k] = (int32_t)(sum / FIXED_POINT_SCALE);
    }
}

PROCESS(compression_process, "Compression_Process");
AUTOSTART_PROCESSES(&compression_process);

PROCESS_THREAD(compression_process, ev, data)
{
    static struct etimer timer;       // Timer for periodic events
    static int reading_index = 0;     // Index of the current reading
    int32_t dct_block[L];             // Block of DCT coefficients of size L
    static int32_t *compressed_block; // Block of compressed DCT coefficients of size M
    static int32_t *temp_block;       // Block of temperature readings of size L

    // for timing of operations
    uint32_t time_sum = 0;
    clock_time_t t0, t1, duration;
    uint32_t duration_microseconds;

    PROCESS_BEGIN(); // Start the process

    // Allocate memory for the compressed block
    memb_init(&compressed_block_memb);

    // // start rtimer
    // t0 = clock_time();
    // // Create the DCT matrix
    // create_dct_matrix();
    // t1 = clock_time();
    // duration = t1 - t0;
    // // convert to microseconds
    // duration_microseconds = (duration * 1000000) / CLOCK_SECOND;

    // // printf("DCT matrix creation time: %", PRIu32 , "\n", dct_time);
    // printf("DCT Matrix time: %" PRIu32 " \n", duration_microseconds);

    // Setup a periodic timer that expires after <t> second
    etimer_set(&timer, CLOCK_SECOND * 0.05);

    // SENSORS_ACTIVATE(sht11_sensor);
    SENSORS_ACTIVATE(light_sensor); // Activate the light sensor

    temp_block = memb_alloc(&temp_block_memb); // Allocate memory for the temperature block

    // read N temperature readings
    while (reading_index < _N)
    {
        PROCESS_WAIT_EVENT_UNTIL(etimer_expired(&timer)); // Wait for the timer to expire

        // Read the temperature and convert it to a fixed-point number
        long light_reading = (int32_t)(FIXED_POINT_SCALE * light_sensor.value(LIGHT_SENSOR_TOTAL_SOLAR) * 0.281616);

        // Store the temperature reading in the block
        temp_block[reading_index % L] = light_reading;
        reading_index++;

        // if the block is full, perform the DCT transform
        if (reading_index % L == 0)
        {
            // print temperature block
            printf("Sensor block: ");
            for (int i = 0; i < L; i++)
            {
                printf("%ld ", temp_block[i]);
            }
            printf("\n");

            t0 = clock_time();

            // perform the DCT transform
            dct_transform(temp_block, dct_block);

            // allocate memory for the compressed block
            compressed_block = memb_alloc(&compressed_block_memb);

            // compress the DCT coefficients
            for (int i = 0; i < M; i++)
            {
                compressed_block[i] = dct_block[i];
            }

            t1 = clock_time();
            duration = t1 - t0;
            // convert to microseconds
            duration_microseconds = (duration * 1000000) / CLOCK_SECOND;
            time_sum += duration_microseconds;

            // print compressed block
            printf("Compressed block: ");
            for (int i = 0; i < M; i++)
            {
                printf("%ld ", compressed_block[i]);
            }
            printf("\n");

            // free the memory allocated for the compressed block
            memb_free(&compressed_block_memb, compressed_block);
            // free the memory allocated for the temperature block
            memb_free(&temp_block_memb, temp_block);
            // allocate memory for the temperature block
            temp_block = memb_alloc(&temp_block_memb);
        }

        // Reset the timer
        etimer_reset(&timer);
    }

    // calculate average time
    printf("Average compression time: %" PRIu32 " \n", time_sum / (_N / L));
    ;

    SENSORS_DEACTIVATE(light_sensor); // Deactivate the temperature sensor
    PROCESS_END();                    // End the process
}
/*---------------------------------------------------------------------------*/